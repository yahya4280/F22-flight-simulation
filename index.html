<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F-22 Flight Simulation</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #hud {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 18px;
            z-index: 10;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 8px;
        }
        #hud div { margin: 5px 0; }
        #crosshair {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: red;
            border-radius: 50%;
            z-index: 20;
        }
    </style>
</head>
<body>
    <div id="hud">
        <div>Speed: <span id="speed">500</span> km/h</div>
        <div>Altitude: <span id="altitude">500</span> m</div>
        <div>Weapon: <span id="weapon">Bullets</span></div>
        <div>G-Force: <span id="gForce">1</span> G</div>
    </div>
    <div id="crosshair"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script>
        // Scene, Camera, Renderer
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 5000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.shadowMap.enabled = true;
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Add Blue Sky
        scene.background = new THREE.Color(0x87CEEB);

        // Terrain
        const terrainGeometry = new THREE.PlaneGeometry(5000, 5000);
        const terrainMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
        const terrain = new THREE.Mesh(terrainGeometry, terrainMaterial);
        terrain.rotation.x = -Math.PI / 2;
        terrain.receiveShadow = true;
        scene.add(terrain);

        // Lighting (Sun and Shadows)
        const sun = new THREE.DirectionalLight(0xffffff, 1);
        sun.position.set(100, 500, 100);
        sun.castShadow = true;
        sun.shadow.mapSize.width = 2048;
        sun.shadow.mapSize.height = 2048;
        scene.add(sun);

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        // HUD Elements
        const speedElement = document.getElementById("speed");
        const gForceElement = document.getElementById("gForce");

        // Camera Position
        camera.position.set(0, 50, -200); // Start behind the jet

        // Load F-22 Raptor Model
        const loader = new THREE.GLTFLoader();
        let jet;
        loader.load(
            'f22_raptor.glb', // Replace with your model path
            function (gltf) {
                jet = gltf.scene;
                jet.scale.set(10, 10, 10);
                jet.position.set(0, 50, 0);
                jet.castShadow = true;
                scene.add(jet);
                console.log('Model loaded successfully!');
            },
            undefined,
            function (error) {
                console.error('Error loading model:', error);
            }
        );

        // Controls and Variables
        let speed = 5; // Increased speed
        let mouseX = 0, mouseY = 0;
        const screenCenterX = window.innerWidth / 2;
        const screenCenterY = window.innerHeight / 2;

        window.addEventListener('mousemove', (event) => {
            mouseX = (event.clientX - screenCenterX) / screenCenterX;
            mouseY = (event.clientY - screenCenterY) / screenCenterY;
        });

        window.addEventListener('keydown', (event) => {
            if (event.key === 'w') speed += 0.5; // Increase speed
            if (event.key === 's') speed = Math.max(1, speed - 0.5); // Decrease speed
        });

        // Calculate G-Force
        let previousVelocity = new THREE.Vector3(0, 0, 0);
        let currentVelocity = new THREE.Vector3(0, 0, 0);

        function calculateGForce(deltaTime) {
            if (!jet) return 1; // Default G-force when stationary

            jet.getWorldDirection(currentVelocity);
            currentVelocity.multiplyScalar(speed / deltaTime);

            const acceleration = currentVelocity.clone().sub(previousVelocity).length();
            previousVelocity.copy(currentVelocity);

            const gForce = acceleration / 9.8; // Convert to G-forces
            return Math.max(1, gForce.toFixed(2)); // Minimum G-force is 1
        }

        // Animate and Render
        let lastTime = performance.now();
        function animate() {
            requestAnimationFrame(animate);

            const currentTime = performance.now();
            const deltaTime = (currentTime - lastTime) / 1000; // Convert ms to seconds
            lastTime = currentTime;

            // Move Jet
            if (jet) {
                jet.rotation.x += -mouseY * 0.02; // Pitch
                jet.rotation.z += mouseX * 0.02; // Roll
                jet.rotation.y += mouseX * 0.01; // Yaw for smoother turns

                const direction = new THREE.Vector3();
                jet.getWorldDirection(direction);
                jet.position.addScaledVector(direction, speed);

                // Camera follows the jet
                camera.position.lerp(
                    new THREE.Vector3(jet.position.x, jet.position.y + 20, jet.position.z - 150),
                    0.1
                );
                camera.lookAt(jet.position);

                // Update HUD
                const gForce = calculateGForce(deltaTime);
                gForceElement.textContent = gForce;
                speedElement.textContent = (speed * 50).toFixed(0); // Scaled speed
            }

            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>
</html>
